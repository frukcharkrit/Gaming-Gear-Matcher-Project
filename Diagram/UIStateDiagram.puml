@startuml
title UI State Transition Diagram - Gaming Gear Matcher

skinparam state {
  BackgroundColor<<Guest>> LightBlue
  BackgroundColor<<Member>> LightGreen
  BackgroundColor<<Admin>> LightCoral
  BorderColor black
  ArrowColor black
}

[*] --> S_Start

state "Start" as S_Start
state "Home (Guest)\n(PG-H01)" as S_Home_Guest <<Guest>>
state "Register\n(PG-A01)" as S_Register <<Guest>>
note right of S_Register
  **Alerts:**
  - Registration failed
end note
state "Login\n(PG-A02)" as S_Login <<Guest>>
note right of S_Login
  **Alerts:**
  - Login fail
end note
state "Forgot Password\n(PG-A03)" as S_Forgot_Pwd <<Guest>>
state "Upload Image\n(PG-M01)" as S_Upload
note right of S_Upload
  **Alerts:**
  - Upload fail (File size/Format)
end note

state "Search & Browse\n(PG-S01)" as S_Search <<Guest>>

state "Matching Result\n(PG-M02)" as S_Result
note right of S_Result
  **Actions:**
  - View Result
  - Rate Match (Give Star/Score)
  **Alerts:**
  - Guest: "Please login to save."
  - Member: "Preset saved!"
  - "Thank you for rating!"
end note

state "Gear Detail\n(PG-D02)" as S_Gear_Detail
state "Pro Player Detail\n(PG-D01)" as S_Pro_Detail

state "Logged In" as S_Logged_In {
  state "Home (Member)\n(PG-H02)" as S_Home_Member <<Member>>
  state "Manage Presets\n(PG-U01)" as S_Manage_Presets <<Member>>
  
  state "Admin Dashboard\n(PG-ADM01)" as S_Admin_Dashboard <<Admin>>
  state "Manage Members\n(PG-ADM02)" as S_Admin_Members <<Admin>>
  
  ' แยก Manage Gear ออกมาเป็น Global State
  state "Manage All Gears\n(PG-ADM03)" as S_Admin_Gears <<Admin>>

  state "Manage Pro Players\n(PG-ADM04)" as S_Admin_Pro <<Admin>> {
    state "Pro Player List" as S_Pro_List
    state "Add/Edit Pro Player" as S_Edit_Pro_Player
    
    [*] --> S_Pro_List
    S_Pro_List --> S_Edit_Pro_Player : Add / Edit
    S_Edit_Pro_Player --> S_Pro_List : Save / Cancel
  }

  state "Manage Models\n(PG-ADM05)" as S_Admin_Models <<Admin>>
}

S_Start --> S_Home_Guest : Enters App

' --- Guest Flow ---
S_Home_Guest --> S_Login : Clicks Login
S_Home_Guest --> S_Register : Clicks Register
S_Home_Guest --> S_Upload : Clicks Start Matching
S_Home_Guest --> S_Search : Clicks Search Gear/Pro

S_Search --> S_Gear_Detail : Select Gear
S_Search --> S_Pro_Detail : Select Pro Player
S_Gear_Detail --> S_Search : Back
S_Pro_Detail --> S_Search : Back

S_Login --> S_Forgot_Pwd : Clicks Forgot Password
S_Forgot_Pwd --> S_Login : Submits email

S_Register --> S_Login : Registration success
S_Register --> S_Register : Fail

S_Login --> S_Home_Member : Login success (Member)
S_Login --> S_Admin_Dashboard : Login success (Admin)
S_Login --> S_Login : Fail

' --- Matching Flow ---
S_Upload --> S_Result : Success
S_Upload --> S_Upload : Fail

S_Result --> S_Gear_Detail : Select gear
S_Gear_Detail --> S_Result : Back

S_Result --> S_Pro_Detail : Select pro player
S_Pro_Detail --> S_Result : Back

' --- Rating & Saving Flow ---
S_Result --> S_Result : Rate Match Result (Ajax/Popup)

S_Result --> S_Login : Guest clicks Save Preset
' จุดสำคัญ: Login เสร็จแล้ว Redirect กลับมาหน้า Result เพื่อ Save ต่อ
S_Login --> S_Result : Redirect back after Login (if from Save)

S_Result --> S_Manage_Presets : Member clicks Save Preset

' --- Member Flow ---
S_Home_Member --> S_Manage_Presets : Clicks My Presets
S_Manage_Presets --> S_Home_Member : Back
S_Home_Member --> S_Upload : Clicks Start Matching
S_Home_Member --> S_Search : Clicks Search

' --- Admin Flow ---
S_Admin_Dashboard --> S_Admin_Members
S_Admin_Members --> S_Admin_Dashboard : Back

S_Admin_Dashboard --> S_Admin_Pro
S_Admin_Pro --> S_Admin_Dashboard : Back

' เพิ่ม Admin Gear Flow
S_Admin_Dashboard --> S_Admin_Gears : Manage All Gears
S_Admin_Gears --> S_Admin_Dashboard : Back

S_Admin_Dashboard --> S_Admin_Models
S_Admin_Models --> S_Admin_Dashboard : Back

' Global Logout
S_Logged_In --> S_Home_Guest : Logout

@enduml